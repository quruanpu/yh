# 优惠券共享系统 - 简化版结构说明

## 一、数据库结构

### yhq_gx（优惠券共享节点）

```json
{
  "yhq_gx": {
    "优惠券id": {
      "guanjianzi": "关键字",
      "gengxinshijian": "更新时间",
      "mingcheng": "优惠券名称",
      "shifenggongxiang": true/false,
      "zengsongzongshu": 总数限制,
      "dandianxianzhi": 单店限制,
      "yifafangzongshu": 已发放总数,
      "yaodiantongji": {
        "药店id": 已发放数量
      }
    }
  }
}
```

{
  "yhq_gx": {
    "优惠券id1": {
      "guanjianzi": "10000/98",
      "gengxinshijian": "2026-01-26 00:50:18",
      "mingcheng": "春节特惠券",
      "shifenggongxiang": true,
      "zengsongzongshu": 100,
      "dandianxianzhi": 5,
      "yifafangzongshu": 6,
      "yaodiantongji": {
        "药店id1": 5,
        "药店id2": 1
      }
    },
    "优惠券id2": {
      "guanjianzi": "5000/98",
      "gengxinshijian": "2026-01-26 00:50:00",
      "mingcheng": "新春优惠券",
      "shifenggongxiang": true,
      "zengsongzongshu": 50,
      "dandianxianzhi": 3,
      "yifafangzongshu": 8,
      "yaodiantongji": {
        "药店id1": 3,
        "药店id3": 5
      }
    }
  }
}

---

## 二、字段说明

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| guanjianzi | string | 优惠券关键字标识 | "10000/98" |
| gengxinshijian | string | 最后更新时间 | "2026-01-26 00:50:18" |
| mingcheng | string | 优惠券显示名称 | "春节特惠券" |
| shifenggongxiang | boolean | 是否启用共享 | true |
| zengsongzongshu | number | 总共可发放数量 | 100 |
| dandianxianzhi | number | 单店最多发放数量 | 5 |
| yifafangzongshu | number | 当前已发放总数 | 6 |
| yaodiantongji | object | 各药店发放数量 | {"药店id1": 5} |

---

## 三、核心业务规则

### 3.1 总量控制
```
yifafangzongshu ≤ zengsongzongshu
```
已发放总数不能超过设定的总数限制

### 3.2 单店限制
```
yaodiantongji[药店id] ≤ dandianxianzhi
```
每个药店发放数量不能超过单店限制

### 3.3 数据一致性
```
yifafangzongshu = sum(yaodiantongji 所有值)
```
已发放总数应等于所有药店发放数量之和

---

## 四、核心业务流程

### 4.1 发放优惠券

**检查流程：**
