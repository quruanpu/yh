<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>优惠券解析测试</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { font-size: 20px; margin-bottom: 20px; color: #333; }

        .input-section { background: #fff; padding: 16px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .input-section label { display: block; font-weight: 500; margin-bottom: 8px; color: #555; }
        .input-section textarea { width: 100%; height: 120px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical; }
        .input-section textarea:focus { outline: none; border-color: #6366f1; }

        .btn { background: #6366f1; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-top: 12px; }
        .btn:hover { background: #4f46e5; }
        .btn-secondary { background: #9ca3af; margin-left: 8px; }
        .btn-secondary:hover { background: #6b7280; }

        .result-section { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .result-section h2 { font-size: 16px; margin-bottom: 12px; color: #333; }

        .step { margin-bottom: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid #6366f1; }
        .step-title { font-weight: 600; color: #6366f1; margin-bottom: 6px; font-size: 13px; }
        .step-content { font-family: monospace; font-size: 13px; color: #333; word-break: break-all; white-space: pre-wrap; }

        .keys { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .key-tag { background: #e0e7ff; color: #4f46e5; padding: 4px 10px; border-radius: 4px; font-size: 12px; }

        .error { color: #ef4444; background: #fef2f2; padding: 10px; border-radius: 6px; }

        .examples { margin-top: 16px; }
        .examples h3 { font-size: 14px; color: #666; margin-bottom: 8px; }
        .example-btn { background: #f3f4f6; border: 1px solid #e5e7eb; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 4px 4px 4px 0; }
        .example-btn:hover { background: #e5e7eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>优惠券解析测试工具</h1>

        <div class="input-section">
            <label>输入内容（支持多行）</label>
            <textarea id="input" placeholder="输入要解析的内容，例如：&#10;2786153，2000的给一张，10000的给一张&#10;1870341，2000的一张，5000的一张，10000的一张"></textarea>
            <button class="btn" onclick="runTest()">解析</button>
            <button class="btn btn-secondary" onclick="clearAll()">清空</button>

            <div class="examples">
                <h3>快速测试：</h3>
                <button class="example-btn" onclick="setExample('2786153，2000的给一张，10000的给一张')">门店+档位</button>
                <button class="example-btn" onclick="setExample('3000/98折')">完整格式</button>
                <button class="example-btn" onclick="setExample('五千、三千、1000各一张')">中文数字</button>
                <button class="example-btn" onclick="setExample('2000-100')">满减格式</button>
                <button class="example-btn" onclick="setExample('98折')">纯折扣</button>
                <button class="example-btn" onclick="setExample('送券')">兜底测试</button>
                <button class="example-btn" onclick="setExample('13800138000 送券')">手机号</button>
                <button class="example-btn" onclick="setExample('K12345 3000')">客户编码</button>
            </div>
        </div>

        <div class="result-section">
            <h2>解析结果</h2>
            <div id="result">
                <p style="color:#999;">请输入内容后点击"解析"按钮</p>
            </div>
        </div>
    </div>

    <script src="jx.js"></script>
    <script>
        function runTest() {
            const input = document.getElementById('input').value;
            const resultDiv = document.getElementById('result');

            if (!input.trim()) {
                resultDiv.innerHTML = '<p class="error">请输入内容</p>';
                return;
            }

            try {
                // 获取模块
                const module = window.ZhiLiaoHdJiexiModule;

                // 步骤1：原始输入
                let html = `<div class="step">
                    <div class="step-title">1. 原始输入</div>
                    <div class="step-content">${escapeHtml(input)}</div>
                </div>`;

                // 步骤2：移除标识符
                const cleaned = module.removeIdentifiers(input);
                html += `<div class="step">
                    <div class="step-title">2. 移除标识符后（门店ID/手机号/客户编码）</div>
                    <div class="step-content">${escapeHtml(cleaned) || '(空)'}</div>
                </div>`;

                // 步骤3：替换中文数字
                const normalized = module.replaceChineseNumbers(cleaned);
                html += `<div class="step">
                    <div class="step-title">3. 替换中文数字后</div>
                    <div class="step-content">${escapeHtml(normalized)}</div>
                </div>`;

                // 步骤4：最终解析结果
                const keys = module.parseInput(input);
                html += `<div class="step">
                    <div class="step-title">4. 最终解析出的关键字</div>
                    <div class="keys">${keys.map(k => `<span class="key-tag">${escapeHtml(k)}</span>`).join('')}</div>
                </div>`;

                // 模拟优惠券匹配
                const mockCoupons = [
                    { id: '1', keyword: '2000/98折', name: '2000/98折' },
                    { id: '2', keyword: '2000/99折', name: '2000/99折' },
                    { id: '3', keyword: '3000/98折', name: '3000/98折' },
                    { id: '4', keyword: '5000/98折', name: '5000/98折' },
                    { id: '5', keyword: '10000/98折', name: '10000/98折' },
                    { id: '6', keyword: '2000-100', name: '满2000减100' },
                ];

                const matched = module.matchKeywords(input, mockCoupons);
                html += `<div class="step">
                    <div class="step-title">5. 匹配到的优惠券（模拟）</div>
                    <div class="keys">${matched.length > 0
                        ? matched.map(c => `<span class="key-tag">${escapeHtml(c.name)}</span>`).join('')
                        : '<span style="color:#999;">无匹配</span>'}</div>
                </div>`;

                resultDiv.innerHTML = html;

            } catch (e) {
                resultDiv.innerHTML = `<p class="error">解析错误: ${escapeHtml(e.message)}</p>`;
                console.error(e);
            }
        }

        function setExample(text) {
            document.getElementById('input').value = text;
            runTest();
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('result').innerHTML = '<p style="color:#999;">请输入内容后点击"解析"按钮</p>';
        }

        function escapeHtml(text) {
            if (!text) return '';
            return String(text)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }
    </script>
</body>
</html>
